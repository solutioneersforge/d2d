@if(isLoading){
<div class="container d-flex justify-content-center align-items-center primary"
     style="height: 100vh">
  <div class="spinner-border text-primary" role="status">
    <span class="visually-hidden">Loading...</span>
  </div>
</div>
} @else {

 <div class="container">
  <form class="bg-light p-4 rounded-3 shadow-sm">
  <div class="container">
    <div class="row g-3 align-items-end">
      <!-- From Date -->
      <div class="col-lg-4 col-md-6 col-sm-12">
        <label for="fromDate" class="form-label fw-semibold text-secondary">From Date</label>
        <div class="input-group">
          <input
            id="fromDate"
            type="text"
            class="form-control border-secondary-subtle"
            bsDatepicker
            [(bsValue)]="fromDate"
            [bsConfig]="{ dateInputFormat: 'YYYY-MM-DD' }"
            readonly
            #fromPicker="bsDatepicker"
            (keydown)="$event.preventDefault()"
          />
          <span class="input-group-text bg-white border-secondary-subtle cursor-pointer" (click)="fromPicker.toggle()">
            <i class="far fa-calendar-alt text-primary"></i>
          </span>
        </div>
      </div>

      <!-- To Date -->
      <div class="col-lg-4 col-md-6 col-sm-12">
        <label for="toDate" class="form-label fw-semibold text-secondary">To Date</label>
        <div class="input-group">
          <input
            id="toDate"
            type="text"
            class="form-control border-secondary-subtle"
            bsDatepicker
            [(bsValue)]="toDate"
            [bsConfig]="{ dateInputFormat: 'YYYY-MM-DD' }"
            readonly
            #toPicker="bsDatepicker"
            (keydown)="$event.preventDefault()"
          />
          <span class="input-group-text bg-white border-secondary-subtle cursor-pointer" (click)="toPicker.toggle()">
            <i class="far fa-calendar-alt text-primary"></i>
          </span>
        </div>
      </div>

      <!-- Month Duration (Radio Group) -->
      <div class="col-lg-4 col-md-12 col-sm-12">
        <label class="form-label fw-semibold text-secondary mb-2">Select Duration</label>
        <div class="d-flex flex-wrap gap-3 bg-white p-3 rounded border border-secondary-subtle">
          @for (option of monthOptions; track $index) {
          <div class="form-check">
            <input
              class="form-check-input border-secondary"
              type="radio"
              name="monthOptions"
              [id]="'month' + option.value"
              [value]="option.value"
              [(ngModel)]="selectedMonth"
              (change)="onMonthSelect(option.value)"
            />
            <label class="form-check-label text-muted" [for]="'month' + option.value">
              {{ option.value }} Month{{ option.value > 1 ? 's' : '' }}
            </label>
          </div>
          }
        </div>
      </div>

      <!-- Search Button -->
      <div class="col-12 mt-3">
        <button type="button" class="btn btn-primary w-100 py-2 fw-semibold" (click)="onSearch()">
          <i class="fas fa-search me-2"></i> Search
        </button>
      </div>
    </div>
  </div>
</form>
</div>

  <div class="container-fluid p-5">
    <!-- Cards View for Mobile -->
     
    <div class="d-block d-lg-none">
      <div class="row">
        @for (item of receiptDashboardDTO; track $index) {
          <div class="col-12 mb-2">
            <div class="card">
              <div class="card-header d-flex">
                <strong>{{ item.merchantName }}</strong>
                <strong class="ms-auto">{{ item.totalAmount | currency }}</strong>
              </div>
              <div class="card-body d-flex flex-column">
                <p class="card-text"><strong>Address: </strong> {{ item.merchantAddress }}</p>
                <p class="card-text"><strong>Invoice: </strong> {{ item.receiptNumber }}</p>
                <p class="card-text"><strong>Invoice Date: </strong> {{ item.receiptDate | date: 'dd-MMM-yyyy'  }}</p>
                <!-- <p class="card-text"><strong>Customer: </strong> {{ item.customerName }}</p>
                <p class="card-text"><strong>Customer Address: </strong> {{ item.customerAddress }}</p> -->
                <!-- <p class="card-text"><strong>Subtotal: </strong> {{ item.subTotalAmount | currency }}</p> -->
                <p class="card-text"><strong>Status: <span [ngClass]="getStatusClass(item.statusId.toString())">{{ item.statusName }}</span></strong></p>
              </div>
            </div>
          </div>
        }
      </div>
    </div>
  
    <!-- Table View for Desktop -->
    <div class="d-none d-lg-block">
      <table class="table table-bordered table-hover">
        <thead class="table-primary">
          <tr>
            <th>No.</th>
            <th>Invoice Date</th>
            <th>Invoice</th>
            <!-- <th>Customer</th>
            <th>Customer Address</th> -->
            <th>Merchant</th>
            <th>Address</th>
            <th>Currency</th>
            <th>Total</th>
            <th>Remarks</th>
            <th>Status</th>
            <th>Action</th>
            <th>Uploaded by | Date</th>
            <th>Approved by | Date</th>
          </tr>
        </thead>
        <tbody>
          @for (item of receiptDashboardDTO; track $index) {
            <tr>
              <td>{{ $index + 1 }}</td>
              <td>{{ item.receiptDate | date:'dd-MMM-yyyy'  }}</td>
              <td>{{ item.receiptNumber }}</td>
              <!-- <td>{{ item.customerName }}</td>
              <td>{{ item.customerAddress }}</td> -->
              <td>{{ item.merchantName }}</td>
              <td>{{ item.merchantAddress }}</td>
               <td>{{ item.currencyCode }}</td>
              <td>{{ item.totalAmount  }}</td>
              <td>{{ item.remarks }}</td>
              <!-- <td>{{ item.subTotalAmount | currency }}</td> -->
              <td><span [ngClass]="getStatusClass(item.statusId.toString())">{{ item.statusName }}</span></td>
           <td>

<div class="dropdown" dropdown>
  <button class="btn btn-primary dropdown-toggle" dropdownToggle>
    {{ item .selectedOption|| 'Select' }}
  </button>

  <ul class="dropdown-menu dropdown-menu-end" *dropdownMenu>
    <li>
      <a class="dropdown-item cursor-pointer" (click)="onMenuItemClick('Edit', item)">
        <i class="fa fa-edit me-2"></i> Edit
      </a>
    </li>
    <li>
      <a class="dropdown-item cursor-pointer" (click)="onMenuItemClick('View', item)">
        <i class="fa fa-eye me-2"></i> View
      </a>
    </li>
    <li><hr class="dropdown-divider"></li>
    <li>
      <a class="dropdown-item text-success cursor-pointer" (click)="onMenuItemClick('Approve', item)">
        <i class="fa fa-check-circle me-2"></i> Approve
      </a>
    </li>
    <li>
      <a class="dropdown-item text-danger cursor-pointer" (click)="onMenuItemClick('Reject', item)">
        <i class="fa fa-times-circle me-2"></i> Reject
      </a>
    </li>
    <li><hr class="dropdown-divider"></li>
    <li>
      <a class="dropdown-item cursor-pointer" (click)="onMenuItemClick('Download PDF', item)">
        <i class="fa fa-file-pdf me-2"></i> Download PDF
      </a>
    </li>
  </ul>
</div>

</td>



<td>
  @if(item.createdBy != ""){
    {{item.createdBy}} | {{item.createdOn | date : "dd-MMM-yyyy"}}
  }
 
</td>
<td>
  @if(item.approvedBy != ""){
{{item.approvedBy}} | {{item.approvedOn | date : "dd-MMM-yyyy"}}
  }
  
</td>

          }
        </tbody>
      </table>
    </div>
  </div>
  
}


<div class="modal fade" id="confirmModal" #confirmModal tabindex="-1" aria-labelledby="confirmModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content border border-primary">
      <!-- Modal Header -->
      <div class="modal-header  bg-primary text-white" >
        <h5 class="modal-title" id="confirmModalLabel">Confirm Action</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <!-- Modal Body -->
      <div class="modal-body">
        <p>Are you sure you want to proceed?</p>
        <div class="mb-3">
          <label for="commentBox" class="form-label">Reject Comment</label>
          <textarea class="form-control" id="commentBox" rows="3" [(ngModel)]="rejectComment"></textarea>
        </div>
      </div>
      <!-- Modal Footer -->
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-primary" (click)="confirmAction()">Confirm</button>
      </div>
    </div>
  </div>
</div>
@if(alert.visible){
<div
  class="toast-container position-fixed top-0 end-0 p-3"
  style="z-index: 1100"
  *ngIf="alert.visible"
>
  <div
    class="toast align-items-center text-white bg-{{ alert.type }} border-0 show"
    role="alert"
    aria-live="assertive"
    aria-atomic="true"
  >
    <div class="d-flex">
      <div class="toast-body">
        {{ alert.message }}
      </div>
      <button
        type="button"
        class="btn-close btn-close-white me-2 m-auto"
        (click)="closeToast()"
      ></button>
    </div>
  </div>
</div>
}
 
